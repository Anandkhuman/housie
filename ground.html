
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sintha housie Announcer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #1a1a2e;
      --panel-bg: #1f1f38;
      --primary-accent: #f7b731;
      --accent-glow: rgba(247, 183, 49, 0.5);
      --text-color-light: #f0f0f0;
      --text-color-dark: #a0a0c0;
      --border-color: #4a4a6a;
      --success-color: #2ecc71;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      height: 100%;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color-light);
      display: flex;
      justify-content: center;
      min-height: 100%;
      overflow: hidden; /* For fixed background */
    }

    #three-canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.7;
    }

    .app-container {
      width: 100%;
      max-width: 500px;
      /* CHANGE 1: Use dynamic viewport height for better mobile support */
      height: 100dvh; 
      display: flex;
      flex-direction: column;
      z-index: 1;
    }

    .app-header {
      padding: 15px;
      background: var(--panel-bg);
      border-bottom: 1px solid var(--border-color);
    }
    
    h1 {
      font-family: 'Cinzel Decorative', cursive;
      font-size: 1.8rem;
      text-align: center;
      color: var(--primary-accent);
      text-shadow: 0 0 10px var(--accent-glow);
      margin-bottom: 15px;
    }
    
    .settings-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        align-items: end;
    }

    .setting-item { display: flex; flex-direction: column; }
    .setting-item.full-width { grid-column: 1 / -1; }
    .setting-item label {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-color-dark);
        margin-bottom: 5px;
    }
    .setting-item select, .setting-item input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--bg-color);
      color: var(--text-color-light);
      font-size: 0.9rem;
    }
    .setting-item select:focus, .setting-item input:focus {
      outline: none;
      border-color: var(--primary-accent);
      box-shadow: 0 0 8px var(--accent-glow);
    }
    .interval-slider-container { display: flex; align-items: center; gap: 10px; }
    input[type="range"] { -webkit-appearance: none; flex-grow: 1; background: transparent; }
    input[type="range"]:focus { outline: none; }
    input[type="range"]::-webkit-slider-runnable-track { height: 6px; cursor: pointer; background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 3px; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: var(--primary-accent); cursor: pointer; margin-top: -7px; box-shadow: 0 0 8px var(--accent-glow); }
    #intervalValue { font-weight: 600; color: var(--primary-accent); font-size: 0.9rem; }

    .app-content {
      flex-grow: 1;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      overflow-y: auto;
       /* For smooth scrolling on iOS */
      -webkit-overflow-scrolling: touch;
    }

    .content-card {
      background: var(--panel-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }
    
    .current-number-display {
      font-weight: 700;
      /* CHANGE 2: Responsive font-size. Min 4.5rem, preferred 20vw, max 6.5rem */
      font-size: clamp(4.5rem, 20vw, 6.5rem);
      text-align: center;
      color: var(--primary-accent);
      text-shadow: 0 0 15px var(--accent-glow);
      line-height: 1;
      /* CHANGE 3: Flexible height based on font size */
      min-height: 1.1em; 
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .current-number-display span { display: inline-block; }
    
    .number-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      /* CHANGE 4: Flexible gap */
      gap: clamp(3px, 1.5vw, 6px);
    }
    .num {
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      aspect-ratio: 1 / 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      /* CHANGE 5: Flexible font size for numbers in the grid */
      font-size: clamp(0.7rem, 2.5vw, 1rem);
      color: var(--text-color-dark);
      cursor: default;
      transition: all 0.3s ease;
    }
    .num.called {
      background: var(--success-color);
      color: var(--bg-color);
      font-weight: 700;
      border-color: var(--success-color);
      box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
      transform: scale(1.05);
    }

    .called-numbers-container h3 {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-color-dark);
        margin-bottom: 10px;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    #calledNumbersList {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        justify-content: center;
        font-size: 0.9rem;
        color: var(--text-color-dark);
        line-height: 1.6;
    }

    .app-footer {
      padding: 15px;
      background: var(--panel-bg);
      border-top: 1px solid var(--border-color);
    }
    
    .controls { display: flex; gap: 15px; }
    .button {
      flex-grow: 1;
      padding: 15px;
      border: none;
      border-radius: 12px;
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }
    #playPauseBtn { background: var(--primary-accent); color: var(--bg-color); }
    #resetBtn { background: var(--border-color); color: var(--text-color-light); }

    .hidden { display: none; }

    /* CHANGE 6: Media Query for small screens */
    @media (max-width: 480px) {
        h1 {
            font-size: 1.5rem; /* Title thoda chhota */
        }
        .settings-grid {
            grid-template-columns: 1fr; /* Settings ko ek ke niche ek rakho */
            gap: 12px;
        }
        .app-header, .app-content, .app-footer, .content-card {
            padding: 10px; /* Padding kam karo */
        }
        .app-content {
            gap: 10px; /* Cards ke beech ka gap kam karo */
        }
        .button {
            padding: 12px;
            font-size: 0.9rem; /* Button ka text thoda chhota */
        }
    }
  </style>
</head>
<body>
  
  <canvas id="three-canvas"></canvas>

  <div class="app-container">

    <header class="app-header">
      <h1>Sintha Housie</h1>
      <div class="settings-grid">
        <div class="setting-item">
          <label for="sourceSelect">Audio Source</label>
          <select id="sourceSelect">
            <option value="sintha">Default (from Sintha Team)</option>
            <option value="google">Browser Voice (TTS)</option>
            <option value="baseurl">Custom URL</option>
          </select>
        </div>
        <div class="setting-item">
          <label for="intervalSlider">Interval</label>
          <div class="interval-slider-container">
              <input id="intervalSlider" type="range" min="3" max="20" value="8">
              <span id="intervalValue">8s</span>
          </div>
        </div>
        <div id="baseUrlContainer" class="setting-item full-width hidden">
          <label for="baseUrl">Custom Audio URL</label>
          <input id="baseUrl" type="text" placeholder="e.g., https://example.com/audio/">
        </div>
      </div>
    </header>

    <main class="app-content">
      <div class="content-card">
        <div class="current-number-display" id="current-number-wrapper">
          <span id="current-number">--</span>
        </div>
      </div>
      
      <div class="content-card">
        <div class="number-grid" id="grid"></div>
      </div>

      <div class="content-card called-numbers-container">
        <h3>Called Numbers (<span id="calledCount">0</span>/90)</h3>
        <div id="calledNumbersList"></div>
      </div>
      
    </main>
    
    <footer class="app-footer">
      <div class="controls">
        <button class="button" id="resetBtn">Reset</button>
        <button class="button" id="playPauseBtn">Start Game</button>
      </div>
    </footer>
  </div>

  <script src="https://unpkg.com/gsap@3.12.5/dist/gsap.min.js"></script>
  <script type="importmap">{ "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }</script>
  <script type="module">
    // --- Three.js background code remains unchanged ---
    import * as THREE from 'three';
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    const pointLight = new THREE.PointLight(0xffd700, 1.5, 100);
    pointLight.position.set(10, 10, 10);
    scene.add(pointLight);
    const orbs = [];
    const orbGeometry = new THREE.SphereGeometry(1, 32, 32);
    const orbMaterial = new THREE.MeshStandardMaterial({ color: '#daa520', metalness: 0.8, roughness: 0.2, transparent: true, opacity: 0.7 });
    for(let i = 0; i < 40; i++) {
        const orb = new THREE.Mesh(orbGeometry, orbMaterial);
        orb.position.set((Math.random() - 0.5) * 20, (Math.random() - 0.5) * 20, (Math.random() - 0.5) * 20);
        orb.scale.setScalar(Math.random() * 0.3 + 0.1);
        orb.userData.velocity = new THREE.Vector3((Math.random() - 0.5) * 0.005, (Math.random() * 0.01) + 0.002, (Math.random() - 0.5) * 0.005);
        orbs.push(orb); scene.add(orb);
    }
    camera.position.z = 5;
    const animate = () => { requestAnimationFrame(animate); orbs.forEach(orb => { orb.position.add(orb.userData.velocity); if (orb.position.y > 10) { orb.position.y = -10; } }); renderer.render(scene, camera); };
    animate();
    window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
  </script>

  <script>
    // --- Javascript code is unchanged, so keeping it as is ---
    document.addEventListener('DOMContentLoaded', () => {
        const grid = document.getElementById('grid');
        const currentNumberSpan = document.getElementById('current-number');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const sourceSelect = document.getElementById('sourceSelect');
        const baseUrlInput = document.getElementById('baseUrl');
        const intervalSlider = document.getElementById('intervalSlider');
        const intervalValue = document.getElementById('intervalValue');
        const baseUrlContainer = document.getElementById('baseUrlContainer');
        const calledNumbersList = document.getElementById('calledNumbersList');
        const calledCountSpan = document.getElementById('calledCount');
        const STORAGE_KEY = 'goldenTambolaState';
        let deck = [];
        let calledNumbers = [];
        let intervalId = null;
        let gameState = 'stopped';
        const saveGameState = () => {
            const state = {
                deck: deck,
                calledNumbers: calledNumbers,
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        };
        const loadGameState = () => {
            const savedState = localStorage.getItem(STORAGE_KEY);
            if (savedState) {
                const state = JSON.parse(savedState);
                deck = state.deck;
                calledNumbers = state.calledNumbers;
                return true;
            }
            return false;
        };
        const initGame = () => {
            clearInterval(intervalId);
            localStorage.removeItem(STORAGE_KEY);
            deck = Array.from({ length: 90 }, (_, i) => i + 1);
            shuffle(deck);
            calledNumbers = [];
            updateBoard();
            updateCalledNumbersDisplay();
            currentNumberSpan.textContent = '--';
            gameState = 'stopped';
            playPauseBtn.textContent = 'Start Game';
            playPauseBtn.disabled = false;
        };
        const updateBoard = () => {
            const allNums = grid.querySelectorAll('.num');
            allNums.forEach(numEl => numEl.classList.remove('called'));
            calledNumbers.forEach(num => {
                const el = document.getElementById('n' + num);
                if (el) el.classList.add('called');
            });
             const lastNumber = calledNumbers.length > 0 ? calledNumbers[calledNumbers.length - 1] : '--';
             currentNumberSpan.textContent = lastNumber;
        };
        const updateCalledNumbersDisplay = () => {
            calledNumbersList.textContent = calledNumbers.join(', ');
            calledCountSpan.textContent = calledNumbers.length;
        };
        const shuffle = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        };
        const createGrid = () => {
            grid.innerHTML = '';
            for (let i = 1; i <= 90; i++) {
                const el = document.createElement('div');
                el.className = 'num';
                el.id = 'n' + i;
                el.textContent = i;
                grid.appendChild(el);
            }
        };
        const playAudio = (num) => {
            const source = sourceSelect.value;
            let audioSrc = null;
            if (source === 'sintha') {
                 audioSrc = `https://raw.githubusercontent.com/Anandkhuman/housie/main/audio/${num}.mp3`;
            } else if (source === 'baseurl' && baseUrlInput.value.trim()) {
                audioSrc = baseUrlInput.value.trim() + `${num}.mp3`;
            }
            if (audioSrc) {
                new Audio(audioSrc).play().catch(() => speakNumber(num));
            } else {
                speakNumber(num);
            }
        };
        const speakNumber = (num) => {
            if (!('speechSynthesis' in window)) {
                console.error("Sorry, your browser doesn't support text-to-speech.");
                return;
            }
            try {
              const utterance = new SpeechSynthesisUtterance(String(num));
              window.speechSynthesis.cancel();
              window.speechSynthesis.speak(utterance);
            } catch (e) {
              console.error("Speech Synthesis failed.", e);
            }
        };
        const callNextNumber = () => {
            if (deck.length === 0) {
                handleGameEnd();
                return;
            }
            const num = deck.shift();
            calledNumbers.push(num);
            saveGameState();
            gsap.timeline()
                .to(currentNumberSpan, { scale: 0.5, opacity: 0, duration: 0.3, ease: 'power2.in' })
                .call(() => {
                    document.getElementById('n' + num)?.classList.add('called');
                    updateCalledNumbersDisplay();
                })
                .set(currentNumberSpan, { textContent: num })
                .to(currentNumberSpan, { scale: 1, opacity: 1, duration: 0.5, ease: 'back.out(1.7)' });
            playAudio(num);
        };
        const handleGameEnd = () => {
             clearInterval(intervalId);
             gameState = 'stopped';
             currentNumberSpan.textContent = 'END';
             playPauseBtn.textContent = 'Game Over';
             playPauseBtn.disabled = true;
        }
        const handlePlayPause = () => {
            if (gameState === 'playing') {
                clearInterval(intervalId);
                gameState = 'paused';
                playPauseBtn.textContent = 'Resume';
            } else {
                if (gameState === 'stopped' && calledNumbers.length === 0) {
                    callNextNumber();
                } else if (gameState === 'stopped' && calledNumbers.length > 0) {}
                const intervalTime = Math.max(2, Number(intervalSlider.value));
                intervalId = setInterval(callNextNumber, intervalTime * 1000);
                gameState = 'playing';
                playPauseBtn.textContent = 'Pause';
            }
        };
        playPauseBtn.addEventListener('click', handlePlayPause);
        resetBtn.addEventListener('click', initGame);
        sourceSelect.addEventListener('change', () => {
            baseUrlContainer.classList.toggle('hidden', sourceSelect.value !== 'baseurl');
        });
        intervalSlider.addEventListener('input', () => {
            intervalValue.textContent = `${intervalSlider.value}s`;
            if (gameState === 'playing') {
                clearInterval(intervalId);
                const intervalTime = Math.max(2, Number(intervalSlider.value));
                intervalId = setInterval(callNextNumber, intervalTime * 1000);
            }
        });
        const setupGame = () => {
            createGrid();
            if (loadGameState()) {
                updateBoard();
                updateCalledNumbersDisplay();
                if (deck.length === 0) {
                    handleGameEnd();
                } else {
                    playPauseBtn.textContent = 'Resume Game';
                }
            } else {
                initGame();
            }
             gsap.from('.app-container > *', { opacity: 0, y: 20, duration: 0.5, stagger: 0.1, ease: 'power2.out' });
        };
        setupGame();
    });
  </script>
</body>
</html>
